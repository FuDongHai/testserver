<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GroupApi.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">im-sdk-core</a> &gt; <a href="index.source.html" class="el_package">com.easemob.im.server.api.group</a> &gt; <span class="el_source">GroupApi.java</span></div><h1>GroupApi.java</h1><pre class="source lang-java linenums">package com.easemob.im.server.api.group;

import com.easemob.im.server.api.Context;
import com.easemob.im.server.api.group.admin.GroupAdminAdd;
import com.easemob.im.server.api.group.admin.GroupAdminList;
import com.easemob.im.server.api.group.admin.GroupAdminRemove;
import com.easemob.im.server.api.group.announcement.GroupAnnouncement;
import com.easemob.im.server.api.group.create.CreateGroup;
import com.easemob.im.server.api.group.delete.DeleteGroup;
import com.easemob.im.server.api.group.get.GetGroup;
import com.easemob.im.server.api.group.list.GroupList;
import com.easemob.im.server.api.group.member.add.GroupMemberAdd;
import com.easemob.im.server.api.group.member.list.GroupMemberList;
import com.easemob.im.server.api.group.member.remove.GroupMemberRemove;
import com.easemob.im.server.api.group.settings.UpdateGroup;
import com.easemob.im.server.api.group.settings.UpdateGroupRequest;
import com.easemob.im.server.model.EMGroup;
import com.easemob.im.server.model.EMPage;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

import java.util.List;
import java.util.function.Consumer;

/**
 * 群API。
 */
public class GroupApi {

    private GroupList groupList;
    private CreateGroup createGroup;
    private DeleteGroup deleteGroup;

    private GetGroup getGroup;
    private UpdateGroup updateGroup;

    private GroupAnnouncement groupAnnouncement;
    private GroupMemberList groupMemberList;
    private GroupMemberAdd groupMemberAdd;
    private GroupMemberRemove groupMemberRemove;

    private GroupAdminList groupAdminList;
    private GroupAdminAdd groupAdminAdd;
    private GroupAdminRemove groupAdminRemove;

<span class="nc" id="L46">    public GroupApi(Context context) {</span>
<span class="nc" id="L47">        this.groupList = new GroupList(context);</span>
<span class="nc" id="L48">        this.createGroup = new CreateGroup(context);</span>
<span class="nc" id="L49">        this.deleteGroup = new DeleteGroup(context);</span>

<span class="nc" id="L51">        this.getGroup = new GetGroup(context);</span>
<span class="nc" id="L52">        this.updateGroup = new UpdateGroup(context);</span>

<span class="nc" id="L54">        this.groupAnnouncement = new GroupAnnouncement(context);</span>

<span class="nc" id="L56">        this.groupMemberList = new GroupMemberList(context);</span>
<span class="nc" id="L57">        this.groupMemberAdd = new GroupMemberAdd(context);</span>
<span class="nc" id="L58">        this.groupMemberRemove = new GroupMemberRemove(context);</span>

<span class="nc" id="L60">        this.groupAdminList = new GroupAdminList(context);</span>
<span class="nc" id="L61">        this.groupAdminAdd = new GroupAdminAdd(context);</span>
<span class="nc" id="L62">        this.groupAdminRemove = new GroupAdminRemove(context);</span>
<span class="nc" id="L63">    }</span>

    /**
     * 创建公开群。
     * 需要注意的是，目前公开群不允许成员邀请其他用户加入。如果要允许，可以用修改群API设置:
     * &lt;pre&gt;{@code
     *      EMService service;
     *      service.group().updateSetting(&quot;group-id&quot;, settings -&gt; settings.memberCanInvite(true)).block();
     * }&lt;/pre&gt;
     *
     * @param owner 群主的用户名
     * @param groupName 群名
     * @param description 群介绍
     * @param members 初始群成员的用户名列表
     * @param maxMembers 群最大成员数
     * @param needApproveToJoin 新成员加入需要管理员审批
     * @return 群id或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BE%A4%E7%BB%84&quot;&gt;创建群&lt;/a&gt;
     */
    public Mono&lt;String&gt; createPublicGroup(String owner, String groupName, String description, List&lt;String&gt; members, int maxMembers, boolean needApproveToJoin) {
<span class="nc" id="L83">        return this.createGroup.publicGroup(owner, groupName, description, members, maxMembers, needApproveToJoin);</span>
    }

    /**
     * 创建私有群。
     *
     * @param owner 群主的用户名
     * @param groupName 群名
     * @param description 群介绍
     * @param members 初始群成员的用户名列表
     * @param maxMembers 群最大成员数
     * @param canMemberInvite 新成员加入需要管理员审批
     * @return 群id或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BE%A4%E7%BB%84&quot;&gt;创建群&lt;/a&gt;
     */
    public Mono&lt;String&gt; createPrivateGroup(String owner, String groupName, String description, List&lt;String&gt; members, int maxMembers, boolean canMemberInvite) {
<span class="nc" id="L99">        return this.createGroup.privateGroup(owner, groupName, description, members, maxMembers, canMemberInvite);</span>
    }

    /**
     * 注销群。
     *
     * @param groupId 群id
     * @return 成功或错误
     */
    public Mono&lt;Void&gt; destroyGroup(String groupId) {
<span class="nc" id="L109">        return this.deleteGroup.execute(groupId);</span>
    }

    /**
     * 获取全部群列表。
     *
     * @return 每个群id或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%8E%B7%E5%8F%96app%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E7%BE%A4%E7%BB%84_%E5%8F%AF%E5%88%86%E9%A1%B5&quot;&gt;获取群列表&lt;/a&gt;
     */
    public Flux&lt;String&gt; listAllGroups() {
<span class="nc" id="L119">        return this.groupList.all(20);</span>
    }

    /**
     * 分页获取群列表。
     *
     * 初次调用时，{@code cursor} 传 {@code null}。之后的调用，{@code cursor} 传上次返回的值。
     *
     * 可以这样遍历群列表：
     * &lt;pre&gt;{@code
     *  EMService service;
     *  GroupListResponse response = service.listGroups(20, null).block();
     *  List&lt;String&gt; groupIds = response.getGroupIds();
     *  // ... do something with the groupIds ...
     *  String cursor = response.getCursor();
     *  // cursor == null indicates the end of the list
     *  while (cursor != null) {
     *      response = service.listGroups(20, cursor);
     *      // ... do something to the groupIds ...
     *      cursor = response.getCursor();
     *  }
     * }&lt;/pre&gt;
     *
     * @param limit 每次取回多少个群id
     * @param cursor 上次返回的{@code cursor}
     * @return 群列表响应或错误
     * @see com.easemob.im.server.model.EMPage
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%8E%B7%E5%8F%96app%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E7%BE%A4%E7%BB%84_%E5%8F%AF%E5%88%86%E9%A1%B5&quot;&gt;获取群列表&lt;/a&gt;
     */
    public Mono&lt;EMPage&lt;String&gt;&gt; listGroups(int limit, String cursor) {
<span class="nc" id="L149">        return this.groupList.next(limit, cursor);</span>
    }

    /**
     * List groups user joined.
     *
     * @param username the username
     * @return A {@code Flux} which emits {@code EMGroup} on successful.
     */
    public Flux&lt;String&gt; listGroupsUserJoined(String username) {
<span class="nc" id="L159">        return this.groupList.userJoined(username);</span>
    }

    /**
     * 获取群详情。
     *
     * @param groupId 群id
     * @return 群详情或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E8%AF%A6%E6%83%85&quot;&gt;获取群详情&lt;/a&gt;
     */
    public Mono&lt;EMGroup&gt; getGroup(String groupId) {
<span class="nc" id="L170">        return this.getGroup.execute(groupId);</span>
    }

    /**
     * 修改群详情。
     * 支持修改的参数见{@code GroupSettingsUpdateRequest}
     * 比如，更新群最大成员数：
     * &lt;pre&gt;{@code
     * EMService service;
     * service.group().updateSettings(&quot;1&quot;, settings -&gt; settings.maxMembers(100)).block();
     * }&lt;/pre&gt;
     *
     * @param groupId 群id
     * @param customizer 请求定制器
     * @return 成功或错误
     * @see UpdateGroupRequest
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E4%BF%AE%E6%94%B9%E7%BE%A4%E7%BB%84%E4%BF%A1%E6%81%AF&quot;&gt;修改群详情&lt;/a&gt;
     */
    public Mono&lt;Void&gt; updateGroup(String groupId, Consumer&lt;UpdateGroupRequest&gt; customizer) {
<span class="nc" id="L189">        return this.updateGroup.update(groupId, customizer);</span>
    }

    /**
     * 修改群主。新群主需要已经是群成员，否则会报错{@code EMForbiddenException}。
     *
     * @param groupId 群id
     * @param username 新群主的用户名
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%BD%AC%E8%AE%A9%E7%BE%A4%E7%BB%84&quot;&gt;修改群主&lt;/a&gt;
     */
    public Mono&lt;Void&gt; updateGroupOwner(String groupId, String username) {
<span class="nc" id="L201">        return this.updateGroup.updateOwner(groupId, username);</span>
    }

    /**
     * 获取群公告。
     *
     * @param groupId 群id
     * @return 群公告或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E5%85%AC%E5%91%8A&quot;&gt;获取群公告&lt;/a&gt;
     */
    public Mono&lt;String&gt; getGroupAnnouncement(String groupId) {
<span class="nc" id="L212">        return this.groupAnnouncement.get(groupId);</span>
    }

    /**
     * 更新群公告。
     *
     * @param groupId 群id
     * @param announcement 群公告
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E4%BF%AE%E6%94%B9%E7%BE%A4%E7%BB%84%E5%85%AC%E5%91%8A&quot;&gt;更新群公告&lt;/a&gt;
     */
    public Mono&lt;Void&gt; updateGroupAnnouncement(String groupId, String announcement) {
<span class="nc" id="L224">        return this.groupAnnouncement.set(groupId, announcement);</span>
    }

    /**
     * 获取群全部成员。
     *
     * @param groupId 群id
     * @return 每个群成员或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98&quot;&gt;获取群成员&lt;/a&gt;
     */
    public Flux&lt;String&gt; listAllGroupMembers(String groupId) {
<span class="nc" id="L235">        return this.groupMemberList.all(groupId, 20);</span>
    }

    /**
     * 分页获取群成员。
     *
     * 首次调用时，{@code cursor} 传 {@code null}。之后每次调用，{@code cursor} 传上次返回的值。
     *
     * 比如：
     *
     * &lt;pre&gt;{@code
     * EMService service;
     * GroupListResponse response = service.listGroupMemberss(&quot;group-id&quot;, 10, null).block();
     * List&lt;EMGroupMembers&gt; groups = response.getEMGroups();
     * // ... do something to the members ...
     * String cursor = response.getCursor();
     * while (cursor != null) {
     *     response = service.listGroupMembers(&quot;group-id&quot;, 10, cursor);
     *     // ... do something to the members ...
     *     cursor = response.getCursor();
     * }
     * }&lt;/pre&gt;

     * @param groupId 群id
     * @param limit 返回多少群成员id
     * @param cursor 开始位置
     * @return 获取群成员响应或错误
     * @see com.easemob.im.server.api.group.member.list.GroupMemberListResponse
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98&quot;&gt;获取群成员&lt;/a&gt;
     */
    public Mono&lt;EMPage&lt;String&gt;&gt; listGroupMembers(String groupId, int limit, String cursor) {
<span class="nc" id="L266">        return this.groupMemberList.next(groupId, limit, cursor);</span>
    }

    /**
     * 添加群成员。
     *
     * @param groupId 群id
     * @param username 要添加的用户的用户名
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%B8%AA%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98&quot;&gt;添加群成员&lt;/a&gt;
     */
    public Mono&lt;Void&gt; addGroupMember(String groupId, String username) {
<span class="nc" id="L278">        return this.groupMemberAdd.single(groupId, username);</span>
    }

    /**
     * 移除群成员。
     *
     * @param groupId 群id
     * @param username 要移除的用户的用户名
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E7%A7%BB%E9%99%A4%E5%8D%95%E4%B8%AA%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98&quot;&gt;移除群成员&lt;/a&gt;
     */
    public Mono&lt;Void&gt; removeGroupMember(String groupId, String username) {
<span class="nc" id="L290">        return this.groupMemberRemove.single(groupId, username);</span>
    }

    /**
     * 获取群全部管理员。
     *
     * @param groupId 群id
     * @return 每个管理员或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E8%8E%B7%E5%8F%96%E7%BE%A4%E7%AE%A1%E7%90%86%E5%91%98%E5%88%97%E8%A1%A8&quot;&gt;获取群管理员&lt;/a&gt;
     */
    public Flux&lt;String&gt; listGroupAdmins(String groupId) {
<span class="nc" id="L301">        return this.groupAdminList.all(groupId);</span>
    }

    /**
     * 升级群成员为群管理员。
     *
     * @param groupId 群id
     * @param username 被升级的群成员的用户名
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E6%B7%BB%E5%8A%A0%E7%BE%A4%E7%AE%A1%E7%90%86%E5%91%98&quot;&gt;升级群成员&lt;/a&gt;
     */
    public Mono&lt;Void&gt; addGroupAdmin(String groupId, String username) {
<span class="nc" id="L313">        return this.groupAdminAdd.single(groupId, username);</span>
    }

    /**
     * 降级群管理员为群成员。
     *
     * @param groupId 群id
     * @param username 被降级的群管理员的用户名
     * @return 成功或错误
     * @see &lt;a href=&quot;http://docs-im.easemob.com/im/server/basics/group#%E7%A7%BB%E9%99%A4%E7%BE%A4%E7%AE%A1%E7%90%86%E5%91%98&quot;&gt;降级群管理员&lt;/a&gt;
     */
    public Mono&lt;Void&gt; removeGroupAdmin(String groupId, String username) {
<span class="nc" id="L325">        return this.groupAdminRemove.single(groupId, username);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>